-- OPERAÇÕES CONTEMPLADAS PELO CASO DE TESTE:
-- ÁRVORE-B DE ORDEM 4
-- COM ARQUIVOS
-- CADASTRO
-- DEPÓSITO E SAQUE
-- CADASTRO DE CHAVE PIX
-- TRANSFERÊNCIA
-- BUSCA DE TRANSAÇÃO
-- LISTAGEM DE TRANSAÇÕES POR PERÍODO
-- LISTAGEM DE TRANSAÇÕES POR CPF DE ORIGEM E PERÍODO
-- IMPRIMIR ARQUIVO CLIENTES
-- IMPRIMIR ARQUIVO TRANSAÇÕES
-- IMPRIMIR ARQUIVO DE ÍNDICE DE CLIENTES
-- IMPRIMIR ARQUIVO DE ÍNDICE DE TRANSAÇÕES
-- IMPRIMIR ARQUIVO DE ÍNDICE DE CHAVES PIX
-- IMPRIMIR ARQUIVO DE ÍNDICE DE TIMESTAMP

\echo file ARQUIVO_CLIENTES
66545678765;Maria Eugenia;12/04/1980;mariaeugenia@gmail.com;15998765645;0000000775.40;A97301660-afcb-4ea4-a5a6-7c3abe8b8fbb&C66545678765&N15998765645&Emariaeugenia@gmail.com;##################################################################################44565434213;Geovana Santana;25/10/1994;ge.santana@gmail.com;16996543652;0000001786.40;Ege.santana@gmail.com&C44565434213;#######################################################################################################################################54654367865;Gustavo Almeida;19/11/1992;galmeida@gmail.com;14998786754;0000000000.00;N14998786754&Egalmeida@gmail.com;###########################################################################################################################################37567876542;Melissa Santos;13/04/1977;melissa@gmail.com;15998765435;1000000440.92;;#############################################################################################################################################################################14565436782;Melissa Pereira;19/09/1993;melissa@gmail.com;15997654738;0000000764.00;Emelissa@gmail.com&A8c29d4ca-06a1-4ef4-b45c-0470946831c5&C14565436782;#######################################################################################################23465784759;Jose Santos;03/07/1968;josesantos@gmail.com;14998786754;0000000000.00;C23465784759;#################################################################################################################################################################95724566812;Roberto Oliveira Jr.;06/07/1976;rojr@house.tech;11976764356;0000000695.00;C95724566812;#############################################################################################################################################################
\echo file ARQUIVO_TRANSACOES
23465784759665456787650000000120.002021101107473754654367865957245668120000000790.002021102919381314565436782665456787650000000050.002021112600231654654367865445654342130000000260.802021121615460623465784759445654342130000000010.002022010616400154654367865445654342130000000200.002022012505581595724566812665456787650000000190.002022021902181295724566812665456787650000000300.002022031014200795724566812665456787650000000200.002022040615160295724566812665456787650000000075.002022042316281644565434213665456787650000001184.402022052014101366545678765957245668120000000100.002022060515305414565436782665456787650000000106.002022062112070695724566812665456787650000000095.002022071107341766545678765145654367820000000670.002022080221274866545678765998765567820000000670.002022082418521966545678765957245668120000000670.002022091223100395724566812665456787650000000005.0020221008014443
\echo index clientes_idx
002145654367820004234657847590005###############T************002665456787650000957245668120006###############T************002375678765420003546543678650002###############F000003001***001445654342130001##############################T************
\echo index transacoes_idx
003145654367822021112600231600021456543678220220621120706001223465784759202110110747370000T************0025465436786520211216154606000354654367865202201250558150005#############################T************003234657847592022010616400100045465436786520211029193813000166545678765202206051530540011F0000040010080029572456681220220310142007000795724566812202204061516020008#############################T************00144565434213202205201410130010##########################################################T************0029572456681220220711073417001395724566812202210080144430017#############################T************00195724566812202204231628160009##########################################################F003005******00195724566812202202190218120006##########################################################F002006******003665456787652022080221274800146654567876520220824185219001566545678765202209122310030016T************
\echo index chaves_pix_idx
00214565436782####################################1456543678214998786754####################################54654367865##########################################################T************002galmeida@gmail.com#############################54654367865ge.santana@gmail.com###########################44565434213##########################################################T************00215998765645####################################6654567876544565434213####################################44565434213##########################################################F000005003***00366545678765####################################665456787658c29d4ca-06a1-4ef4-b45c-0470946831c5###########1456543678295724566812####################################95724566812T************001melissa@gmail.com##############################14565436782####################################################################################################################T************00123465784759####################################23465784759####################################################################################################################T************001mariaeugenia@gmail.com#########################66545678765####################################################################################################################F001004******00197301660-afcb-4ea4-a5a6-7c3abe8b8fbb###########66545678765####################################################################################################################F002006******
\echo index timestamp_cpf_origem_idx
00220211011074737234657847592021102919381354654367865#########################T************00220211216154606546543678652022010616400123465784759#########################T************00220211126002316145654367822022012505581554654367865#########################F000001003***00220220219021812957245668122022031014200795724566812#########################T************00220220423162816957245668122022052014101344565434213#########################T************00220220621120706145654367822022071107341795724566812#########################T************00220220605153054665456787652022080221274866545678765#########################F004005008***0012022040615160295724566812##################################################F002006******003202208241852196654567876520220912231003665456787652022100801444395724566812T************

SET TIME 1633938457;
OK
SET SRAND 11945338153067011559;
OK

INSERT INTO transacoes VALUES ('66545678765', 'ge.santana@gmail.com', 45);
OK
\echo file ARQUIVO_TRANSACOES
23465784759665456787650000000120.002021101107473754654367865957245668120000000790.002021102919381314565436782665456787650000000050.002021112600231654654367865445654342130000000260.802021121615460623465784759445654342130000000010.002022010616400154654367865445654342130000000200.002022012505581595724566812665456787650000000190.002022021902181295724566812665456787650000000300.002022031014200795724566812665456787650000000200.002022040615160295724566812665456787650000000075.002022042316281644565434213665456787650000001184.402022052014101366545678765957245668120000000100.002022060515305414565436782665456787650000000106.002022062112070695724566812665456787650000000095.002022071107341766545678765145654367820000000670.002022080221274866545678765998765567820000000670.002022082418521966545678765957245668120000000670.002022091223100395724566812665456787650000000005.002022100801444366545678765445654342130000000045.0020211011074737
\echo index transacoes_idx
003145654367822021112600231600021456543678220220621120706001223465784759202110110747370000T************003546543678652021121615460600035465436786520220125055815000566545678765202110110747370018T************003234657847592022010616400100045465436786520211029193813000166545678765202206051530540011F0000040010080029572456681220220310142007000795724566812202204061516020008#############################T************00144565434213202205201410130010##########################################################T************0029572456681220220711073417001395724566812202210080144430017#############################T************00195724566812202204231628160009##########################################################F003005******00195724566812202202190218120006##########################################################F002006******003665456787652022080221274800146654567876520220824185219001566545678765202209122310030016T************
\echo index timestamp_cpf_origem_idx
003202110110747372346578475920211011074737665456787652021102919381354654367865T************00220211216154606546543678652022010616400123465784759#########################T************00220211126002316145654367822022012505581554654367865#########################F000001003***00220220219021812957245668122022031014200795724566812#########################T************00220220423162816957245668122022052014101344565434213#########################T************00220220621120706145654367822022071107341795724566812#########################T************00220220605153054665456787652022080221274866545678765#########################F004005008***0012022040615160295724566812##################################################F002006******003202208241852196654567876520220912231003665456787652022100801444395724566812T************

INSERT INTO transacoes VALUES ('15998765645', 'ge.santana@gmail.com', 320);
OK
\echo file ARQUIVO_TRANSACOES
23465784759665456787650000000120.002021101107473754654367865957245668120000000790.002021102919381314565436782665456787650000000050.002021112600231654654367865445654342130000000260.802021121615460623465784759445654342130000000010.002022010616400154654367865445654342130000000200.002022012505581595724566812665456787650000000190.002022021902181295724566812665456787650000000300.002022031014200795724566812665456787650000000200.002022040615160295724566812665456787650000000075.002022042316281644565434213665456787650000001184.402022052014101366545678765957245668120000000100.002022060515305414565436782665456787650000000106.002022062112070695724566812665456787650000000095.002022071107341766545678765145654367820000000670.002022080221274866545678765998765567820000000670.002022082418521966545678765957245668120000000670.002022091223100395724566812665456787650000000005.002022100801444366545678765445654342130000000045.002021101107473766545678765445654342130000000320.0020211029193813
\echo index transacoes_idx
003145654367822021112600231600021456543678220220621120706001223465784759202110110747370000T************0025465436786520211216154606000354654367865202201250558150005#############################T************0022346578475920220106164001000454654367865202110291938130001#############################F000004001***0029572456681220220310142007000795724566812202204061516020008#############################T************00144565434213202205201410130010##########################################################T************0029572456681220220711073417001395724566812202210080144430017#############################T************00195724566812202204231628160009##########################################################F003005******0026654567876520211011074737001895724566812202202190218120006#############################F002010006***003665456787652022080221274800146654567876520220824185219001566545678765202209122310030016T************00166545678765202110291938130019##########################################################T************00166545678765202206051530540011##########################################################F009008******
\echo index timestamp_cpf_origem_idx
00220211011074737234657847592021101107473766545678765#########################T************00220211216154606546543678652022010616400123465784759#########################T************003202110291938135465436786520211126002316145654367822022012505581554654367865F00000900100300220220219021812957245668122022031014200795724566812#########################T************00220220423162816957245668122022052014101344565434213#########################T************00220220621120706145654367822022071107341795724566812#########################T************00220220605153054665456787652022080221274866545678765#########################F004005008***0012022040615160295724566812##################################################F002006******003202208241852196654567876520220912231003665456787652022100801444395724566812T************0012021102919381366545678765##################################################T************

INSERT INTO transacoes VALUES ('mariaeugenia@gmail.com', 'ge.santana@gmail.com', 75);
OK
\echo file ARQUIVO_TRANSACOES
23465784759665456787650000000120.002021101107473754654367865957245668120000000790.002021102919381314565436782665456787650000000050.002021112600231654654367865445654342130000000260.802021121615460623465784759445654342130000000010.002022010616400154654367865445654342130000000200.002022012505581595724566812665456787650000000190.002022021902181295724566812665456787650000000300.002022031014200795724566812665456787650000000200.002022040615160295724566812665456787650000000075.002022042316281644565434213665456787650000001184.402022052014101366545678765957245668120000000100.002022060515305414565436782665456787650000000106.002022062112070695724566812665456787650000000095.002022071107341766545678765145654367820000000670.002022080221274866545678765998765567820000000670.002022082418521966545678765957245668120000000670.002022091223100395724566812665456787650000000005.002022100801444366545678765445654342130000000045.002021101107473766545678765445654342130000000320.002021102919381366545678765445654342130000000075.0020211126002316
\echo index transacoes_idx
003145654367822021112600231600021456543678220220621120706001223465784759202110110747370000T************0025465436786520211216154606000354654367865202201250558150005#############################T************0022346578475920220106164001000454654367865202110291938130001#############################F000004001***0029572456681220220310142007000795724566812202204061516020008#############################T************00144565434213202205201410130010##########################################################T************0029572456681220220711073417001395724566812202210080144430017#############################T************00195724566812202204231628160009##########################################################F003005******0026654567876520211011074737001895724566812202202190218120006#############################F002010006***003665456787652022080221274800146654567876520220824185219001566545678765202209122310030016T************0026654567876520211029193813001966545678765202111260023160020#############################T************00166545678765202206051530540011##########################################################F009008******
\echo index timestamp_cpf_origem_idx
00220211011074737234657847592021101107473766545678765#########################T************003202111260023166654567876520211216154606546543678652022010616400123465784759T************003202110291938135465436786520211126002316145654367822022012505581554654367865F00000900100300220220219021812957245668122022031014200795724566812#########################T************00220220423162816957245668122022052014101344565434213#########################T************00220220621120706145654367822022071107341795724566812#########################T************00220220605153054665456787652022080221274866545678765#########################F004005008***0012022040615160295724566812##################################################F002006******003202208241852196654567876520220912231003665456787652022100801444395724566812T************0012021102919381366545678765##################################################T************

INSERT INTO transacoes VALUES ('44565434213', '15998765645', 334.6);
OK
\echo file ARQUIVO_TRANSACOES
23465784759665456787650000000120.002021101107473754654367865957245668120000000790.002021102919381314565436782665456787650000000050.002021112600231654654367865445654342130000000260.802021121615460623465784759445654342130000000010.002022010616400154654367865445654342130000000200.002022012505581595724566812665456787650000000190.002022021902181295724566812665456787650000000300.002022031014200795724566812665456787650000000200.002022040615160295724566812665456787650000000075.002022042316281644565434213665456787650000001184.402022052014101366545678765957245668120000000100.002022060515305414565436782665456787650000000106.002022062112070695724566812665456787650000000095.002022071107341766545678765145654367820000000670.002022080221274866545678765998765567820000000670.002022082418521966545678765957245668120000000670.002022091223100395724566812665456787650000000005.002022100801444366545678765445654342130000000045.002021101107473766545678765445654342130000000320.002021102919381366545678765445654342130000000075.002021112600231644565434213665456787650000000334.6020211216154606
\echo index transacoes_idx
003145654367822021112600231600021456543678220220621120706001223465784759202110110747370000T************0025465436786520211216154606000354654367865202201250558150005#############################T************0022346578475920220106164001000454654367865202110291938130001#############################F000004001***0029572456681220220310142007000795724566812202204061516020008#############################T************0024456543421320211216154606002144565434213202205201410130010#############################T************0029572456681220220711073417001395724566812202210080144430017#############################T************00195724566812202204231628160009##########################################################F003005******0026654567876520211011074737001895724566812202202190218120006#############################F002010006***003665456787652022080221274800146654567876520220824185219001566545678765202209122310030016T************0026654567876520211029193813001966545678765202111260023160020#############################T************00166545678765202206051530540011##########################################################F009008******
\echo index timestamp_cpf_origem_idx
00220211011074737234657847592021101107473766545678765#########################T************00220211126002316665456787652021121615460644565434213#########################T************00220211029193813546543678652021112600231614565436782#########################F000009001***00220220219021812957245668122022031014200795724566812#########################T************00220220423162816957245668122022052014101344565434213#########################T************00220220621120706145654367822022071107341795724566812#########################T************00220220605153054665456787652022080221274866545678765#########################F004005008***00220211216154606546543678652022040615160295724566812#########################F002011006***003202208241852196654567876520220912231003665456787652022100801444395724566812T************0012021102919381366545678765##################################################T************0012022010616400123465784759##################################################T************0012022012505581554654367865##################################################F010003******

-- busca de transação
SELECT * FROM transacoes WHERE cpf_origem = '14565436782' AND timestamp = '20211126002316';
Nos percorridos: 7 2 0
14565436782, 66545678765, 50.00, 20211126002316
SELECT * FROM transacoes WHERE cpf_origem = '14565436782' AND timestamp = '20211011074737';
Nos percorridos: 7 2 0
ERRO: Registro nao encontrado
SELECT * FROM transacoes WHERE cpf_origem = '23465784759' AND timestamp = '20211011074737';
Nos percorridos: 7 2 0
23465784759, 66545678765, 120.00, 20211011074737
SELECT * FROM transacoes WHERE cpf_origem = '95724566812' AND timestamp = '20221008014443';
Nos percorridos: 7 6 5
95724566812, 66545678765, 5.00, 20221008014443
SELECT * FROM transacoes WHERE cpf_origem = '95724566812' AND timestamp = '20221008014444';
Nos percorridos: 7 6 5
ERRO: Registro nao encontrado
SELECT * FROM transacoes WHERE cpf_origem = '14565436782' AND timestamp = '20211029193813';
Nos percorridos: 7 2 0
ERRO: Registro nao encontrado

-- listagem de transação por período
SELECT * FROM transacoes WHERE timestamp BETWEEN '20211011074737' AND '20221008014443' ORDER BY timestamp ASC;
23465784759, 66545678765, 120.00, 20211011074737
66545678765, 44565434213, 45.00, 20211011074737
54654367865, 95724566812, 790.00, 20211029193813
66545678765, 44565434213, 320.00, 20211029193813
14565436782, 66545678765, 50.00, 20211126002316
66545678765, 44565434213, 75.00, 20211126002316
44565434213, 66545678765, 334.60, 20211216154606
54654367865, 44565434213, 260.80, 20211216154606
23465784759, 44565434213, 10.00, 20220106164001
54654367865, 44565434213, 200.00, 20220125055815
95724566812, 66545678765, 190.00, 20220219021812
95724566812, 66545678765, 300.00, 20220310142007
95724566812, 66545678765, 200.00, 20220406151602
95724566812, 66545678765, 75.00, 20220423162816
44565434213, 66545678765, 1184.40, 20220520141013
66545678765, 95724566812, 100.00, 20220605153054
14565436782, 66545678765, 106.00, 20220621120706
95724566812, 66545678765, 95.00, 20220711073417
66545678765, 14565436782, 670.00, 20220802212748
66545678765, 99876556782, 670.00, 20220824185219
66545678765, 95724566812, 670.00, 20220912231003
95724566812, 66545678765, 5.00, 20221008014443
SELECT * FROM transacoes WHERE timestamp BETWEEN '20211011074737' AND '20211011074737' ORDER BY timestamp ASC;
23465784759, 66545678765, 120.00, 20211011074737
66545678765, 44565434213, 45.00, 20211011074737
SELECT * FROM transacoes WHERE timestamp BETWEEN '20211029193813' AND '20211029193813' ORDER BY timestamp ASC;
54654367865, 95724566812, 790.00, 20211029193813
66545678765, 44565434213, 320.00, 20211029193813
SELECT * FROM transacoes WHERE timestamp BETWEEN '20211126002316' AND '20211126002316' ORDER BY timestamp ASC;
14565436782, 66545678765, 50.00, 20211126002316
66545678765, 44565434213, 75.00, 20211126002316
SELECT * FROM transacoes WHERE timestamp BETWEEN '20211216154606' AND '20211216154606' ORDER BY timestamp ASC;
44565434213, 66545678765, 334.60, 20211216154606
54654367865, 44565434213, 260.80, 20211216154606
SELECT * FROM transacoes WHERE timestamp BETWEEN '20220106164001' AND '20220106164001' ORDER BY timestamp ASC;
23465784759, 44565434213, 10.00, 20220106164001
SELECT * FROM transacoes WHERE timestamp BETWEEN '20220125055815' AND '20220125055815' ORDER BY timestamp ASC;
54654367865, 44565434213, 200.00, 20220125055815
SELECT * FROM transacoes WHERE timestamp BETWEEN '20220219021812' AND '20220219021812' ORDER BY timestamp ASC;
95724566812, 66545678765, 190.00, 20220219021812
SELECT * FROM transacoes WHERE timestamp BETWEEN '20220310142007' AND '20220310142007' ORDER BY timestamp ASC;
95724566812, 66545678765, 300.00, 20220310142007
SELECT * FROM transacoes WHERE timestamp BETWEEN '20220406151602' AND '20220406151602' ORDER BY timestamp ASC;
95724566812, 66545678765, 200.00, 20220406151602
SELECT * FROM transacoes WHERE timestamp BETWEEN '20220125055815' AND '20220219021812' ORDER BY timestamp ASC;
54654367865, 44565434213, 200.00, 20220125055815
95724566812, 66545678765, 190.00, 20220219021812
SELECT * FROM transacoes WHERE timestamp BETWEEN '20221008014443' AND '20221008014443' ORDER BY timestamp ASC;
95724566812, 66545678765, 5.00, 20221008014443
SELECT * FROM transacoes WHERE timestamp BETWEEN '20220219021812' AND '20220125055815' ORDER BY timestamp ASC;
AVISO: Nenhum registro encontrado
SELECT * FROM transacoes WHERE timestamp BETWEEN '20221008014443' AND '2023' ORDER BY timestamp ASC;
95724566812, 66545678765, 5.00, 20221008014443
SELECT * FROM transacoes WHERE timestamp BETWEEN '2021' AND '20211011074737' ORDER BY timestamp ASC;
23465784759, 66545678765, 120.00, 20211011074737
66545678765, 44565434213, 45.00, 20211011074737

-- listagem de transação por CPF de origem e período
SELECT * FROM transacoes WHERE cpf_origem = '99876556782' AND timestamp BETWEEN '20211011074737' AND '20221008014443' ORDER BY timestamp ASC;
AVISO: Nenhum registro encontrado
SELECT * FROM transacoes WHERE cpf_origem = '66545678765' AND timestamp BETWEEN '20211011074737' AND '20221008014443' ORDER BY timestamp ASC;
66545678765, 44565434213, 45.00, 20211011074737
66545678765, 44565434213, 320.00, 20211029193813
66545678765, 44565434213, 75.00, 20211126002316
66545678765, 95724566812, 100.00, 20220605153054
66545678765, 14565436782, 670.00, 20220802212748
66545678765, 99876556782, 670.00, 20220824185219
66545678765, 95724566812, 670.00, 20220912231003
SELECT * FROM transacoes WHERE cpf_origem = '95724566812' AND timestamp BETWEEN '20211011074737' AND '20211029193813' ORDER BY timestamp ASC;
AVISO: Nenhum registro encontrado
SELECT * FROM transacoes WHERE cpf_origem = '95724566812' AND timestamp BETWEEN '20211126002316' AND '20220219021811' ORDER BY timestamp ASC;
AVISO: Nenhum registro encontrado
SELECT * FROM transacoes WHERE cpf_origem = '99876556782' AND timestamp BETWEEN '20221008014443' AND '20211011074737' ORDER BY timestamp ASC;
AVISO: Nenhum registro encontrado
SELECT * FROM transacoes WHERE cpf_origem = '95724566812' AND timestamp BETWEEN '20220310142007' AND '20220406151602' ORDER BY timestamp ASC;
95724566812, 66545678765, 300.00, 20220310142007
95724566812, 66545678765, 200.00, 20220406151602
SELECT * FROM transacoes WHERE cpf_origem = '23465784759' AND timestamp BETWEEN '20220310142007' AND '20220406151602' ORDER BY timestamp ASC;
AVISO: Nenhum registro encontrado
SELECT * FROM transacoes WHERE cpf_origem = '23465784759' AND timestamp BETWEEN '20220310142007' AND '20220406151602' ORDER BY timestamp ASC;
AVISO: Nenhum registro encontrado
SELECT * FROM transacoes WHERE cpf_origem = '14565436782' AND timestamp BETWEEN '202201' AND '202203' ORDER BY timestamp ASC;
AVISO: Nenhum registro encontrado

\q
